<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/layout/index :: dynamic(~{::main})}">
    <body>
        <main>
            <style>
                /* Banner */
                .hero-banner {
                    background: linear-gradient(135deg, #0d6efd 0%, #0043a8 100%); /* M√†u xanh ƒë·∫≠m */
                    border-radius: 20px;
                    padding: 60px 40px;
                    color: white;
                    margin-bottom: 40px;
                    box-shadow: 0 10px 30px rgba(13, 110, 253, 0.3);
                    position: relative;
                    overflow: hidden;
                }
                
                /* Khung t√¨m ki·∫øm n·ªïi */
                .search-container {
                    background: white;
                    padding: 25px;
                    border-radius: 15px;
                    box-shadow: 0 10px 40px rgba(0,0,0,0.08);
                    margin-top: -60px; /* ƒê·∫©y l√™n ƒë√® l√™n banner */
                    margin-bottom: 50px;
                    position: relative;
                    z-index: 10;
                    border: 1px solid #f0f0f0;
                }
                
                /* Card S·∫£n ph·∫©m */
                .product-card {
                    border: 1px solid #eee;
                    border-radius: 15px;
                    overflow: hidden;
                    transition: all 0.3s ease;
                    background: white;
                    height: 100%;
                }
                .product-card:hover {
                    transform: translateY(-8px);
                    box-shadow: 0 15px 30px rgba(0,0,0,0.1);
                    border-color: #bdf;
                }
                
                /* ·∫¢nh s·∫£n ph·∫©m chu·∫©n size */
                .product-img-wrap {
                    height: 200px;
                    width: 100%;
                    overflow: hidden;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background: #fff;
                    padding: 15px;
                }
                .product-img {
                    max-height: 100%;
                    max-width: 100%;
                    object-fit: contain; /* Gi·ªØ nguy√™n t·ªâ l·ªá ·∫£nh */
                    transition: transform 0.5s;
                }
                .product-card:hover .product-img { transform: scale(1.1); }
                
                /* Gi√° ti·ªÅn */
                .price-tag { color: #dc3545; font-weight: 700; font-size: 1.1rem; }
                .old-price { font-size: 0.9rem; text-decoration: line-through; color: #999; margin-left: 5px; }
            </style>
            
            <div class="container py-4">
                
                <div class="hero-banner">
                    <div class="row align-items-center">
                        <div class="col-md-7">
                            <span class="badge bg-warning text-dark mb-2 px-3 py-2 rounded-pill">Khuy·∫øn m√£i HOT</span>
                            <h1 class="display-4 fw-bold mb-3">Si√™u Sale C√¥ng Ngh·ªá 2026 üöÄ</h1>
                            <p class="lead mb-4 opacity-75">SƒÉn ngay Laptop, iPhone, Ph·ª• ki·ªán gi√° s·ªëc. Gi·∫£m gi√° l√™n ƒë·∫øn 50% cho th√†nh vi√™n m·ªõi.</p>
                        </div>
                        <div class="col-md-5 d-none d-md-block text-center">
                            <i class="bi bi-cart-check-fill" style="font-size: 120px; color: rgba(255,255,255,0.3);"></i>
                        </div>
                    </div>
                </div>
                
                <div class="search-container">
                    <form action="/product/search" method="get" class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label class="form-label fw-bold small text-secondary">T√äN S·∫¢N PH·∫®M</label>
                            <input type="text" class="form-control bg-light border-0 py-2" name="keywords" th:value="${keywords}" placeholder="T√¨m iPhone, Laptop...">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold small text-secondary">KHO·∫¢NG GI√Å</label>
                            <select class="form-select bg-light border-0 py-2" name="priceRange">
                                <option value="0">T·∫•t c·∫£ m·ª©c gi√°</option>
                                <option value="1" th:selected="${priceRange == 1}">D∆∞·ªõi 10 tri·ªáu</option>
                                <option value="2" th:selected="${priceRange == 2}">10 - 20 tri·ªáu</option>
                                <option value="3" th:selected="${priceRange == 3}">Tr√™n 20 tri·ªáu</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold small text-secondary">LO·∫†I H√ÄNG</label>
                            <select class="form-select bg-light border-0 py-2" name="categoryId">
                                <option value="">T·∫•t c·∫£ lo·∫°i</option>
                                <option th:each="c : ${categories}" th:value="${c.id}" th:text="${c.name}" th:selected="${c.id == categoryId}"></option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100 fw-bold py-2 shadow-sm">
                                <i class="bi bi-search me-1"></i> T√åM KI·∫æM
                            </button>
                        </div>
                    </form>
                </div>
                
                <div th:if="${searchResult != null}" class="mb-5 animate__animated animate__fadeIn">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 class="fw-bold text-primary m-0"><i class="bi bi-search"></i> K·∫æT QU·∫¢ T√åM KI·∫æM</h4>
                        <span class="badge bg-light text-dark border">T√¨m th·∫•y [[${searchResult.totalElements}]] s·∫£n ph·∫©m</span>
                    </div>
                    
                    <div th:if="${searchResult.empty}" class="text-center py-5 bg-light rounded-3">
                        <i class="bi bi-box-seam fs-1 text-muted"></i>
                        <p class="mt-3 text-muted">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o ph√π h·ª£p.</p>
                        <a href="/home/index" class="btn btn-outline-primary btn-sm mt-2">X√≥a b·ªô l·ªçc</a>
                    </div>
                    
                    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
                        <div class="col" th:each="p : ${searchResult}">
                            <div class="product-card h-100 d-flex flex-column">
                                <div class="product-img-wrap">
                                    <img th:src="@{|/images/${p.image}|}" class="product-img" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                                </div>
                                <div class="p-3 d-flex flex-column flex-grow-1">
                                    <h6 class="text-dark fw-bold text-truncate mb-2">[[${p.name}]]</h6>
                                    <div class="mt-auto">
                                        <div class="d-flex align-items-center mb-3">
                                            <span class="price-tag">[[${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´</span>
                                        </div>
                                        <a th:href="@{|/product/detail/${p.id}|}" class="btn btn-outline-primary w-100 rounded-pill btn-sm fw-bold">Chi ti·∫øt</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div th:if="${searchResult.totalPages > 1}" class="mt-4 text-center">
                        <div class="btn-group shadow-sm" role="group">
                            <a class="btn btn-light border" th:classappend="${searchResult.first} ? 'disabled'"
                               th:href="@{/product/search(p=${searchResult.number - 1}, keywords=${keywords}, categoryId=${categoryId}, priceRange=${priceRange})}">Tr∆∞·ªõc</a>
                            <span class="btn btn-primary disabled border-primary">Trang [[${searchResult.number + 1}]]</span>
                            <a class="btn btn-light border" th:classappend="${searchResult.last} ? 'disabled'"
                               th:href="@{/product/search(p=${searchResult.number + 1}, keywords=${keywords}, categoryId=${categoryId}, priceRange=${priceRange})}">Sau</a>
                        </div>
                    </div>
                </div>
                
                <div th:if="${searchResult == null}">
                    
                    <section class="mb-5">
                        <div class="d-flex align-items-center mb-4 pb-2 border-bottom">
                            <h4 class="fw-bold m-0 text-uppercase"><i class="bi bi-stars text-warning me-2"></i> H√†ng M·ªõi V·ªÅ</h4>
                        </div>
                        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
                            <div class="col" th:each="p : ${newProducts}">
                                <div class="product-card h-100 position-relative">
                                    <span class="badge bg-success position-absolute top-0 end-0 m-3 z-1">M·ªõi</span>
                                    <div class="product-img-wrap">
                                        <img th:src="@{|/images/${p.image}|}" class="product-img" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                                    </div>
                                    <div class="p-3">
                                        <h6 class="text-truncate fw-bold mb-2">[[${p.name}]]</h6>
                                        <div class="price-tag">[[${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´</div>
                                    </div>
                                    <div class="px-3 pb-3">
                                        <a th:href="@{|/product/detail/${p.id}|}" class="btn btn-primary w-100 rounded-pill btn-sm">Xem ngay</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <section class="mb-5">
                        <div class="d-flex align-items-center mb-4 pb-2 border-bottom">
                            <h4 class="fw-bold m-0 text-uppercase text-danger"><i class="bi bi-lightning-charge-fill me-2"></i> ƒêang Gi·∫£m Gi√°</h4>
                        </div>
                        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
                            <div class="col" th:each="p : ${saleProducts}">
                                <div class="product-card h-100 position-relative border-danger">
                                    <span class="badge bg-danger position-absolute top-0 start-0 m-3 z-1">-15%</span>
                                    <div class="product-img-wrap">
                                        <img th:src="@{|/images/${p.image}|}" class="product-img" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                                    </div>
                                    <div class="p-3">
                                        <h6 class="text-truncate fw-bold mb-2">[[${p.name}]]</h6>
                                        <div class="d-flex align-items-center">
                                            <span class="price-tag text-danger">[[${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´</span>
                                            <small class="old-price">[[${#numbers.formatDecimal(p.price * 1.15, 0, 'COMMA', 0, 'POINT')}]]ƒë</small>
                                        </div>
                                    </div>
                                    <div class="px-3 pb-3">
                                        <a th:href="@{|/product/detail/${p.id}|}" class="btn btn-danger w-100 rounded-pill btn-sm">Mua ngay</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <section class="mb-5">
                        <div class="d-flex align-items-center mb-4 pb-2 border-bottom">
                            <h4 class="fw-bold m-0 text-uppercase text-warning"><i class="bi bi-trophy-fill me-2"></i> Top B√°n Ch·∫°y</h4>
                        </div>
                        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
                            <div class="col" th:each="p : ${bestSellers}">
                                <div class="product-card h-100">
                                    <div class="product-img-wrap">
                                        <img th:src="@{|/images/${p.image}|}" class="product-img" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                                    </div>
                                    <div class="p-3">
                                        <h6 class="text-truncate fw-bold mb-2">[[${p.name}]]</h6>
                                        <div class="price-tag">[[${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´</div>
                                    </div>
                                    <div class="px-3 pb-3">
                                        <a th:href="@{|/product/detail/${p.id}|}" class="btn btn-outline-dark w-100 rounded-pill btn-sm">
                                            <i class="bi bi-cart-plus me-1"></i> Th√™m v√†o gi·ªè
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </body>
</html>