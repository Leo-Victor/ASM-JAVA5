<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/layout/index :: dynamic(~{::main})}">
    <body>
        <main>
            <div class="container mt-4">
                
                <div class="alert alert-secondary mb-4 shadow-sm">
                    <h5 class="fw-bold text-uppercase mb-0">
                        <i class="bi bi-list-ul"></i> DANH SÁCH SẢN PHẨM
                        <span th:if="${catId != null}">- MÃ LOẠI: [[${catId}]]</span>
                        <span th:if="${keywords != null}">- KẾT QUẢ TÌM KIẾM</span>
                    </h5>
                    <div th:if="${keywords != null}" class="mt-2 small text-muted">
                        <span th:if="${keywords != ''}">Từ khóa: "<strong>[[${keywords}]]</strong>" | </span>
                        <span th:if="${priceRange == 1}">Giá: Dưới 10 triệu | </span>
                        <span th:if="${priceRange == 2}">Giá: 10 - 20 triệu | </span>
                        <span th:if="${priceRange == 3}">Giá: Trên 20 triệu | </span>
                    </div>
                </div>
                
                <div th:if="${items == null or items.content.empty}" class="alert alert-warning text-center py-5">
                    <i class="bi bi-search display-1 text-muted"></i>
                    <p class="mt-3 fw-bold">Không tìm thấy sản phẩm nào phù hợp!</p>
                    <a href="/home/index" class="btn btn-outline-dark mt-2">
                        <i class="bi bi-arrow-left"></i> Về trang chủ
                    </a>
                </div>
                
                <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4 mb-5">
                    
                    <div class="col" th:each="p : ${items}">
                        <div class="card h-100 shadow-sm border-0 hover-effect">
                            <div class="position-relative">
                                <img th:src="@{|/images/${p.image}|}"
                                     class="card-img-top"
                                     style="height: 200px; object-fit: cover;"
                                     alt="Product Image"
                                     onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200?text=No+Image';">
                                
                                <span class="position-absolute top-0 end-0 badge bg-danger m-2"
                                      th:if="${p.price > 20000000}">-10%</span>
                            </div>
                            
                            <div class="card-body">
                                <h6 class="card-title text-truncate fw-bold">
                                    <a th:href="@{|/product/detail/${p.id}|}" class="text-decoration-none text-dark">
                                        [[${p.name}]]
                                    </a>
                                </h6>
                                
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                     <span class="text-danger fw-bold fs-5">
                                        [[${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')}]] ₫
                                     </span>
                                </div>
                            </div>
                            
                            <div class="card-footer bg-white border-0 pb-3">
                                <div class="d-grid gap-2">
                                    <a th:href="@{|/product/detail/${p.id}|}" class="btn btn-outline-primary btn-sm">
                                        <i class="bi bi-eye"></i> Xem chi tiết
                                    </a>
                                    <a th:href="@{|/cart/add/${p.id}|}" class="btn btn-primary btn-sm">
                                        <i class="bi bi-cart-plus"></i> Thêm vào giỏ
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div th:if="${items.totalPages > 1}" class="d-flex justify-content-center mb-5">
                    <nav aria-label="Page navigation">
                        <ul class="pagination shadow-sm">
                            
                            <li class="page-item" th:classappend="${items.first} ? 'disabled'">
                                <a th:if="${catId != null}" class="page-link"
                                   th:href="@{|/product/list-by-category/${catId}?p=${items.number - 1}|}">
                                    <i class="bi bi-chevron-left"></i>
                                </a>
                                <a th:if="${keywords != null}" class="page-link"
                                   th:href="@{/product/search(keywords=${keywords}, categoryId=${categoryId}, priceRange=${priceRange}, p=${items.number - 1})}">
                                    <i class="bi bi-chevron-left"></i>
                                </a>
                            </li>
                            
                            <li class="page-item"
                                th:each="i : ${#numbers.sequence(0, items.totalPages - 1)}"
                                th:classappend="${i == items.number} ? 'active'">
                                
                                <a th:if="${catId != null}" class="page-link"
                                   th:href="@{|/product/list-by-category/${catId}?p=${i}|}"
                                   th:text="${i + 1}">
                                </a>
                                
                                <a th:if="${keywords != null}" class="page-link"
                                   th:href="@{/product/search(keywords=${keywords}, categoryId=${categoryId}, priceRange=${priceRange}, p=${i})}"
                                   th:text="${i + 1}">
                                </a>
                            </li>
                            
                            <li class="page-item" th:classappend="${items.last} ? 'disabled'">
                                <a th:if="${catId != null}" class="page-link"
                                   th:href="@{|/product/list-by-category/${catId}?p=${items.number + 1}|}">
                                    <i class="bi bi-chevron-right"></i>
                                </a>
                                <a th:if="${keywords != null}" class="page-link"
                                   th:href="@{/product/search(keywords=${keywords}, categoryId=${categoryId}, priceRange=${priceRange}, p=${items.number + 1})}">
                                    <i class="bi bi-chevron-right"></i>
                                </a>
                            </li>
                        
                        </ul>
                    </nav>
                </div>
            
            </div>
        </main>
    </body>
</html>