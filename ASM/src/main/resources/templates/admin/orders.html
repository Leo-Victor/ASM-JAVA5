<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/admin/layout-admin :: dynamic(~{::body})}">
    <body>
        <div class="container-fluid px-4 pt-4">
            
            <h3 class="fw-bold text-dark border-start border-5 border-primary ps-3 mb-4">QU·∫¢N L√ù ƒê∆†N H√ÄNG</h3>
            
            <div th:if="${param.message != null}" class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
                <i class="bi bi-check-circle-fill me-2"></i> C·∫≠p nh·∫≠t ƒë∆°n h√†ng th√†nh c√¥ng!
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            
            <div class="row g-4">
                
                <div class="col-lg-5">
                    
                    <div th:if="${order == null}" class="card border-0 shadow-sm rounded-4 h-100 py-5 text-center">
                        <div class="card-body">
                            <i class="bi bi-receipt display-1 text-muted opacity-25"></i>
                            <h5 class="mt-3 text-muted">Ch·ªçn m·ªôt ƒë∆°n h√†ng ƒë·ªÉ xem chi ti·∫øt</h5>
                            <p class="small text-muted">Click v√†o n√∫t "C·∫≠p nh·∫≠t" b√™n danh s√°ch</p>
                        </div>
                    </div>
                    
                    <div th:if="${order != null}" class="card border-0 shadow-sm rounded-4 h-100">
                        <div class="card-header bg-white py-3 border-bottom">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0 fw-bold text-primary">
                                    <i class="bi bi-info-circle me-2"></i> ƒê∆°n h√†ng #[[${order.id}]]
                                </h5>
                                <span class="badge rounded-pill px-3 py-2"
                                      th:classappend="${order.status == 0 ? 'bg-warning text-dark' :
                                                       (order.status == 1 ? 'bg-primary' :
                                                       (order.status == 2 ? 'bg-success' : 'bg-danger'))}">
                                    <span th:if="${order.status == 0}">Ch·ªù x√°c nh·∫≠n</span>
                                    <span th:if="${order.status == 1}">ƒêang giao h√†ng</span>
                                    <span th:if="${order.status == 2}">ƒê√£ giao th√†nh c√¥ng</span>
                                    <span th:if="${order.status == 3}">ƒê√£ h·ªßy</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="card-body p-4">
                            <form action="/admin/order/update" method="post" class="mb-4 p-3 bg-light rounded-3 border">
                                <input type="hidden" name="id" th:value="${order.id}">
                                <label class="form-label fw-bold small text-muted">C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng:</label>
                                <div class="input-group">
                                    <select name="status" class="form-select fw-bold">
                                        <option value="0" th:selected="${order.status == 0}">üü° Ch·ªù x√°c nh·∫≠n</option>
                                        <option value="1" th:selected="${order.status == 1}">üîµ ƒêang giao h√†ng</option>
                                        <option value="2" th:selected="${order.status == 2}">üü¢ ƒê√£ giao th√†nh c√¥ng</option>
                                        <option value="3" th:selected="${order.status == 3}">üî¥ H·ªßy ƒë∆°n h√†ng</option>
                                    </select>
                                    <button class="btn btn-primary fw-bold">
                                        <i class="bi bi-save me-1"></i> L∆∞u
                                    </button>
                                </div>
                            </form>
                            
                            <h6 class="fw-bold text-dark border-bottom pb-2 mb-3">Th√¥ng tin kh√°ch h√†ng</h6>
                            <ul class="list-unstyled small mb-4">
                                <li class="mb-2"><i class="bi bi-person me-2 text-secondary"></i> <strong>Ng∆∞·ªùi ƒë·∫∑t:</strong> [[${order.account.fullname}]]</li>
                                <li class="mb-2"><i class="bi bi-calendar3 me-2 text-secondary"></i> <strong>Ng√†y ƒë·∫∑t:</strong> [[${#dates.format(order.createDate, 'dd/MM/yyyy HH:mm')}]]</li>
                                <li class="mb-2"><i class="bi bi-geo-alt me-2 text-secondary"></i> <strong>ƒê·ªãa ch·ªâ:</strong> [[${order.address}]]</li>
                                <li class="mb-2"><i class="bi bi-cash-stack me-2 text-secondary"></i> <strong>T·ªïng ti·ªÅn:</strong> <span class="text-danger fw-bold fs-6">[[${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´</span></li>
                            </ul>
                            
                            <h6 class="fw-bold text-dark border-bottom pb-2 mb-3">S·∫£n ph·∫©m ƒë√£ mua</h6>
                            <div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
                                <table class="table table-sm table-borderless align-middle mb-0">
                                    <tbody>
                                        <tr th:each="d : ${details}" class="border-bottom">
                                            <td style="width: 50px;">
                                                <img th:src="@{|/images/${d.product.image}|}" class="rounded border" width="40" height="40" style="object-fit: cover;">
                                            </td>
                                            <td>
                                                <div class="fw-bold text-dark small">[[${d.product.name}]]</div>
                                                <div class="text-muted" style="font-size: 11px;">
                                                    [[${#numbers.formatDecimal(d.price, 0, 'COMMA', 0, 'POINT')}]] x [[${d.quantity}]]
                                                </div>
                                            </td>
                                            <td class="text-end fw-bold text-primary small">
                                                [[${#numbers.formatDecimal(d.price * d.quantity, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-7">
                    <div class="card border-0 shadow-sm rounded-4 h-100">
                        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 fw-bold text-dark">
                                <i class="bi bi-list-ul me-2"></i> Danh s√°ch ƒë∆°n h√†ng
                            </h5>
                            <span class="badge bg-secondary rounded-pill">[[${#lists.size(items)}]] ƒê∆°n</span>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="bg-light small text-uppercase fw-bold text-secondary">
                                        <tr>
                                            <th class="ps-4">M√£ ƒêH</th>
                                            <th>Kh√°ch h√†ng</th>
                                            <th>Ng√†y ƒë·∫∑t</th>
                                            <th>T·ªïng ti·ªÅn</th>
                                            <th>Tr·∫°ng th√°i</th>
                                            <th class="text-end pe-4">Thao t√°c</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="o : ${items}"
                                            th:classappend="${order != null && order.id == o.id} ? 'table-primary' : ''">
                                            <td class="ps-4 fw-bold text-primary">#[[${o.id}]]</td>
                                            <td>
                                                <div class="fw-bold text-dark">[[${o.account.fullname}]]</div>
                                                <small class="text-muted">[[${o.account.username}]]</small>
                                            </td>
                                            <td class="small">[[${#dates.format(o.createDate, 'dd/MM/yyyy')}]]</td>
                                            <td class="text-danger fw-bold">[[${#numbers.formatDecimal(o.totalAmount, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´</td>
                                            <td>
                                                <span th:if="${o.status == 0}" class="badge bg-warning text-dark border border-warning">Ch·ªù duy·ªát</span>
                                                <span th:if="${o.status == 1}" class="badge bg-primary border border-primary">ƒêang giao</span>
                                                <span th:if="${o.status == 2}" class="badge bg-success border border-success">ƒê√£ giao</span>
                                                <span th:if="${o.status == 3}" class="badge bg-danger border border-danger">ƒê√£ h·ªßy</span>
                                            </td>
                                            <td class="text-end pe-4">
                                                <a th:href="@{|/admin/order/edit/${o.id}|}" class="btn btn-sm btn-outline-primary shadow-sm">
                                                    <i class="bi bi-pencil-square me-1"></i> C·∫≠p nh·∫≠t
                                                </a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            
            </div>
            
            <div class="mb-5"></div>
        </div>
    </body>
</html>